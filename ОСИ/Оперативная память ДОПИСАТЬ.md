#оси 
## Устройство памяти
Размеры памяти сейчас дошли до очень больших, поэтому хранить табличку, которая учитывает каждый байт, очень затратно. Поэтому вся память (внешняя или оперативная) делится на блоки.

Размеры блоков варьируются от 512 до 32768 байт. В современных компьютерах чаще всего используются блоки по 4096 байт - 4 Кб. 
- Если блоки, на которые разбивается память, имеют одинаковый размер, то такие блоки называются **страницами**.
- Если блоки, на которые разбивается память, имеют неодинаковый размер, то такие блоки называются **сегментами**. 

## Распределение оперативной памяти
Учёт распределения оперативной памяти осуществляется с помощью двух инструментов:
- Битовая карта
- Связный список свободных/занятых блоков

### Битовая карта
Табличка, где в одном столбце лежат номера блоков, а во втором - их состояние (свободен: 0 / занят: 1)

### Связный список свободных/занятых блоков
Обычно в системах наблюдается список свободных блоков.

Элемент списка включает в себя:
- Указатель на 1 свободный блок
- Длина (количество подряд-стоящих свободных блоков)
- Указатель на следующий свободный блок

## Стратегии управления оперативной памятью
Распределение и перераспределение оперативной памятью представляют 3 стратегии управления:
- Стратегии выборки
- Стратегия размещения
- Стратегия замещения

### Стратегии выборки
Эти стратегии ставят своей целью определить, когда следует втолкнуть очередной блок программы или данных в оперативную память.

Виды:
- Упреждающая выборка
- Выборка по запросу - когда процессу необходим блок памяти, он её запрашивает, и она переносится из внешней в оперативную. Когда память заполняется - переходим к стратегии замещения.

### Стратегия размещения
Эта стратегия ставит своей целью определять, в какое место оперативной памяти следует поместить блок памяти. (смотрим битовую карту или список свободных блоков и туда вталкиваем)

### Стратегия замещения
Ставит своей целью определить, какой блок программы или данных необходимо вытолкнуть из оперативной памяти, чтобы поместить туда поступающую информацию. Существует порядка 20-ти алгоритмов этой стратегии.

Алгоритмы замещения:
1. Оптимальный
	Пока что не используется нигде. Гласит, что из памяти надо вытолкнуть тот блок, обращение к которому производилось раньше всех. Трудозатратный, поэтому не находит себе применения.
2. FIFO ("first in - first out")
	Смотрит время добавления блока в память. В настоящее время мало где используется, потому что можно удалить блок, который нужен.
3. Модифицированный FIFO
	Как FIFO, только перед удалением проверяет, занят ли блок
4. NRU ("Not Recently Used")
	Применяется в системе Windows. Удаляется блок, неиспользованный в последнее время.
5. Часы
	Применяется в системах UNIX. Блоки часов абстрактно расставляются по циферблату. При прохождении указателя (стрелки часов) скидывается бит использования - $1 \to 0$ (0 - не использован, 1 - использован). Указатель застревает на выкинутом блоке и следующий проход начинает с него.
	
	Есть модификация с 2 указателями (стрелками). Одна сбрасывает биты использования, а другая проверяет их. Этот алгоритм похож на NRU, только вместо времени неиспользования у нас есть бит использования.

## Концепции распределения памяти
### Связное распределение
#### Полновластное владение
Суть - программе выделяется вся оперативная память целиком. После отработки программы она выгружается из оперативки, и в неё поступает другая.
- **Swapping (своппинг)** - процедуры, связанные с выгрузкой процессов из оперативной памяти во внешнюю и обратной загрузки из оперативной памяти во внешнюю
Проблема: в оперативку может не влезть вся программа

Иллюстрация распределения памяти на программу:
![[Pasted image 20250930172553.png|650]]

#### Мультипрограммирование с постоянными разделами
![[Pasted image 20250930173611.png|650]]

#### Мультипрограммирование с переменными разделами
Каждой программе выделяется столько памяти, сколько она просит.
![[Pasted image 20251001110316.png|650]]

Такой концепцией пользуются такие ОС, как: RT-11, РАФОС.

Главная проблема такой концепции - фрагментация (появление "дырочек" в памяти). 

Чтобы избавиться от этой проблемы, ОС приостанавливает все процессы и занимается уплотнением памяти (сбором мусора или сквизирование памяти). Во время уплотнения ОС не реагирует ни на какие факторы извне, из-за чего такие ОС стали малопопулярными.

#### Мультипрограммный своппинг
Микс своппинга (swapping) и мультипрограммирования с переменными разделами. Такая концепция использовалась IBM, но сейчас канула в лету.

### Несвязное распределение (виртуальная память)
Виртуальная память - использование вымышленных адресов памяти, которая по своему объёму может существенно превосходить имеющуюся оперативную память компьютера.

#### Своппинг со страничной подкачкой
ДОПИСАТЬ

#### Виртуальная память
Концепция:
- Есть начальный адрес таблицы отображения блоков:  a
- Есть виртуальный адрес $v = (d, s)$
	- d - смещение записи в таблице отображения блоков (ТОБ)
	- s - смещение (номер байта в блоке)
- Получается, что номер записи в ТОБ: $d' = a + d$
- s-ый байт в записи - $\varphi$

То есть, суть виртуальной памяти - расширение пространства памяти за счёт вымышленных адресов и поддержки механизма преобразования виртуального адреса в реальный.