#оси #файловая_система
[[Файлы, файловая система]]
# Способы реализации файловой системы
## Неразрывные файлы
Память представляет неразрывную последовательность блоков. 
Плюсы:
- Файл может быть прочитан за 1 операцию - поставить головку диска на начало файла и прочитать
- Обладает самой высокой производительностью
Минусы:
- Надо заранее знать размер файла
- Фрагментальность (файл А удалили, а другие не помещаются - появляется дырка)
![[Pasted image 20251021121252.png|300]]

## Список
Каждый файл представляется в виде однонаправленного списка блоков. Доступ к файлам довольно медленный.
![[Pasted image 20251021122059.png|400]]

## Список с индексацией
По этой схеме указатель на следующий блок хранится не прямо в блоках, а в отдельной таблице. Эта таблица называется File Allocation Table (FAT) и постоянно хранится в оперативной памяти. В каталоге хранится только адрес первого блока.
![[Pasted image 20251021122435.png|300]]

## I-узлы (I-Node)
Это таблица индексных дескрипторов файла. С каждым файлом связана структура данных, называемая узлом. В структуре указаны атрибуты файла и адреса блоков файла. 

## NTFS (New Technology File System)
Считается, что каждый файл состоит из атрибутов. Основные атрибуты:
- имя файла (256 байтов)
- идентификатор файла (8 байтов)
- поток с данными - те блоки на диске, которые занимает файл (1024 байта)

В этой файловой системе происходит вот такой флекс:
- Диск форматируется и делится на блоки и тома
- Каждый том - линейная последовательность блоков (или кластеров)
- Обращение к блоку осуществляется по его смещению от начала тома
- Основной структурой в каждом томе является MFT (Master File Table) таблица. Эта таблица тоже является файлом. MFT таблица может содержать $2^{48}$ записей. Длина каждой записи - 1 Кб, и она описывает 1 файл или каталог. 
- Если файл слишком большой, то создаётся дополнительная запись, чтобы вместить список всех блоков файла
- Список свободных записей MFT таблицы учитывается с помощью [[Оперативная память|битовой карты]]
- Первая запись в MFT таблице содержит информацию о расположении блоков MFT

Каждая запись в ТИД содержит все 14 атрибутов и определяется по идентификатору ФС и номеру индексного дескриптора.

Всякий раз, когда создается новый файл, ядро ОС Unix создает новую запись в ТИД для сохранения информации о нем. Кроме того, ядро добавляет его имея и номер индексного дескриптора в соответствующий каталог.

ТИД содержатся в соответствующих файловых системах на диске, но ядро ОС Unix ведет их копии и в оперативной памяти.