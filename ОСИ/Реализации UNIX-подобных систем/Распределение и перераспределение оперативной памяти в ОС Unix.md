#оси 
## Структура ОП
1. Ядро ОС
2. Карта памяти
3. Страница памяти

## Распределение ОП на основе [[Оперативная память|своппинга]]
![[Pasted image 20260119121819.png]]
Своппингом занимается процесс с id = 0

1. [[fork|fork()]]
2. brk()
3. Выгрузка процессов. Критерий выгрузки - приоритет + время пребывания в ОП

### Приоритеты
1. В первую очередь выгружаются процессы, находящиеся в состоянии "блокирован";
2. Далее выгружаются процессы в состоянии "готов", дольше всех находящийся во внешней памяти;
	Каждые несколько секунд (по умолчанию 2 сек) исследуются процессы во внешней памяти для перевода процессов из состояния "блокирован" в состояние "готов"
3. Тяжелый своппинг - прежде чем сделать обычный своппинг, надо освободить место

### Условия прекращения/приостановки загрузки процессов из внешней памяти в оперативную
1. Во внешней памяти нет процессов с состоянием "готов"
2. В оперативной памяти нет места для нового процесса
Ни один процесс не выгружается из оперативной памяти, если время его присутствия там - менее 2 секунд. 

## Своппинг со страничной подкачкой
Суть подхода:
Чтобы работать, процессу не нужно целиком находиться в ОП. Достаточно присутствия нескольких страниц. Как только идет обращение к странице, которой нет в памяти, происходит страничное прерывание, и нужная страница подтягивается из внешней памяти в оперативную. Ненужные страницы - отправляются обратно во внешнюю.

Чтобы работать, процессу требуется:
- Контекст процесса
- Таблица страниц процедурного сегмента
- Таблица страниц сегмента данных
- Таблица страниц динамического сегмента

Страницы с процедурным сегментом, сегментом данных и динамическим сегментом подтягиваются по мере обращения к ним. Эта процедура и называется **страничной подкачкой**.

Страничная подкачка реализуется процессом с идентификатором 0 (своппер) и процессом с идентификатором 2 (страничный демон). Страничный демон отвечает за список свободных страниц и реализует **алгоритм замещения страниц**.

## Карта памяти
![[Pasted image 20260126122513.png]]

## Алгоритм замещения страниц
Каждые 250 секунд страничный демон просыпается и смотрит, количество свободных страниц в памяти ($lostfree \sim \frac{1}{4}\text{V памяти}$). В некоторых системах используются 2 параметра: min, max. Если количество свободных страниц меньше lostfree или min, страничный демон начинает переносить страницы из ОП во внешнюю память, пока количество свободных страниц не станет равным lostfree или max.

Страничный демон реализует [[Оперативная память|алгоритм часов]]

При выполнении процесс может вызвать страничное прерывание, если одна или несколько его страниц отсутствуют в оперативной памяти. В этом случае берется первая страница из списка свободных страниц и удаляется из этого списка. В эту страницу загружается требуемая страница из внешней памяти.

Если список свободных страниц пуст - процесс останавливается до тех пор, пока страничный демон не освободит страницу.

Если процедура замещения занимает более 20 единиц процессорного времени, включается процедура своппинга процесса. Из ОП начинают выгружаться целые процессы.