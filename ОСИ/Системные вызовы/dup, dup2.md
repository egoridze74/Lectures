#оси #системные_вызовы
## dup
Название произошло от слова _duplicate_
```
int dup(int fd);
```

Дублирует запись с номером fd в таблице открытых файлов процесса на первое свободное место в таблице и возвращает номер этой копии в случае успеха.

```
dup(1); #вернёт 3
```
![[Pasted image 20250923150523.png|300]]

В случае, когда записи с номером fd нет, dup вернёт -1

Зачем вообще дап нужен? Прмиер:
```
#include <fcntl.h>
dup(1); //вернул 3
open("a.txt", O_WRONLY) //вернул 4
close(1); //закрыли пользовательский дескриптор 1
dup(4); //вернёт 1. a.txt оказался в таблице под номером 1
printf("Hello\n"); //принтф закинется в a.txt
```
С помощью этой штуки можно написать свой [freopen](https://en.cppreference.com/w/cpp/io/c/freopen.html) (хотим перенаправить stdout в файл):

## dup2
```
int dup2(int fd, int new_fd);
```
- fd - номер записи, который дублируется
- new_fd - номер записи, в которую будет дублироваться запись с номером fd
В случае успеха возвращает номер этой записи (new_fd). В случае неудачи -1.

Если номер new_fd занят, то dup2 закроет этот дескриптор и перекопирует из fd в new_fd.

Пример:
```
dup2(1, 10); \\вернёт 10
dup2(2, 4); \\вернёт 4
dup2(5, 0); \\вернёт -1
```

И dup, и dup2 реализованы через вызов fcntl();